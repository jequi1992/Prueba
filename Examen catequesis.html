<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafíos de Catequesis</title>
    <!-- Incluyendo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Usando la fuente Inter de Tailwind */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Un azul-gris muy claro */
        }
        
        /* Estilos para los juegos */
        .game-card {
            transition: all 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .game-card.completed {
            background-color: #e0f2fe; /* light-blue-100 */
            border-color: #0284c7; /* light-blue-600 */
        }
        .game-card.completed .check-mark {
            display: block;
        }
        
        /* --- Estilos para 'Armar' (Ordenar) --- */
        .sort-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .sort-item:hover {
            background-color: #f1f5f9; /* gray-100 */
        }
        .sort-item.correct {
            background-color: #dcfce7; /* green-100 */
            border-color: #22c55e; /* green-500 */
            color: #166534; /* green-800 */
            cursor: not-allowed;
        }
        
        /* --- Estilos para 'Unir' (Emparejar) --- */
        .match-item {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #e5e7eb; /* gray-200 */
        }
        .match-item:hover {
            border-color: #3b82f6; /* blue-500 */
            background-color: #eff6ff; /* blue-50 */
        }
        .match-item.selected {
            background-color: #bfdbfe; /* blue-200 */
            border-color: #3b82f6; /* blue-500 */
        }
        .match-item.matched {
            background-color: #dcfce7; /* green-100 */
            border-color: #22c55e; /* green-500 */
            color: #166534; /* green-800 */
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* --- Estilos para 'Completar' (Input) --- */
        .complete-input {
            border-color: #9ca3af; /* gray-400 */
            transition: all 0.2s ease;
        }
        .complete-input:focus {
            border-color: #3b82f6; /* blue-500 */
            box-shadow: 0 0 0 3px #bfdbfe; /* blue-200 */
            outline: none;
        }
        .complete-input.correct {
            border-color: #22c55e; /* green-500 */
            background-color: #f0fdf4; /* green-50 */
        }
        .complete-input.incorrect {
            border-color: #ef4444; /* red-500 */
            background-color: #fef2f2; /* red-50 */
        }

        /* --- Animación de 'Error' --- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Contenedor Principal -->
    <div class="w-full max-w-4xl mx-auto">

        <!-- --- Pantalla de Inicio --- -->
        <div id="start-screen" class="text-center bg-white p-8 md:p-12 rounded-2xl shadow-xl">
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-700 mb-4">¡Desafío de Catequesis!</h1>
            <p class="text-xl text-gray-600 mb-8">Completa los 4 mini-juegos interactivos para demostrar lo que has aprendido.</p>
            <button id="start-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-12 rounded-lg text-xl transition duration-300 transform hover:scale-105">
                ¡Comenzar!
            </button>
        </div>

        <!-- --- Pantalla del Menú de Juegos (Hub) --- -->
        <div id="hub-screen" class="hidden">
            <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-8">Sala de Desafíos</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Tarjeta 1: Armar -->
                <div id="card-armar" class="game-card" data-game-id="armar" bg-white p-6 rounded-2xl shadow-lg border-4 border-white cursor-pointer>
                    <div class="flex items-center">
                        <span class="text-3xl mr-4">&#128221;</span> <!-- Icono de 'ordenar' -->
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Armar la Confesión</h2>
                            <p class="text-gray-600">Coloca los 5 pasos en orden.</p>
                            <span class="check-mark hidden font-bold text-green-600">¡Completado! &#10003;</span>
                        </div>
                    </div>
                </div>
                
                <!-- Tarjeta 2: Completar -->
                <div id="card-completar" class="game-card" data-game-id="completar" bg-white p-6 rounded-2xl shadow-lg border-4 border-white cursor-pointer>
                    <div class="flex items-center">
                        <span class="text-3xl mr-4">&#9999;&#65039;</span> <!-- Icono de 'escribir' -->
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Completar Oraciones</h2>
                            <p class="text-gray-600">Rellena las palabras que faltan.</p>
                            <span class="check-mark hidden font-bold text-green-600">¡Completado! &#10003;</span>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta 3: Unir Sacramentos -->
                <div id="card-unir-sacr" class="game-card" data-game-id="unir-sacr" bg-white p-6 rounded-2xl shadow-lg border-4 border-white cursor-pointer>
                    <div class="flex items-center">
                        <span class="text-3xl mr-4">&#128279;</span> <!-- Icono de 'unir' -->
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Unir los Sacramentos</h2>
                            <p class="text-gray-600">Empareja el sacramento y su gracia.</p>
                            <span class="check-mark hidden font-bold text-green-600">¡Completado! &#10003;</span>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta 4: Unir Misa -->
                <div id="card-unir-misa" class="game-card" data-game-id="unir-misa" bg-white p-6 rounded-2xl shadow-lg border-4 border-white cursor-pointer>
                    <div class="flex items-center">
                        <span class="text-3xl mr-4">&#128279;</span> <!-- Icono de 'unir' -->
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">El Tesoro de la Misa</h2>
                            <p class="text-gray-600">Empareja objetos y personas.</p>
                            <span class="check-mark hidden font-bold text-green-600">¡Completado! &#10003;</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- --- Pantalla de Juego Activo --- -->
        <div id="game-screen" class="hidden bg-white p-8 md:p-12 rounded-2xl shadow-xl">
            <button id="back-to-hub" class="mb-6 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">&larr; Volver al Menú</button>
            <h2 id="game-title" class="text-3xl font-bold text-gray-800 mb-6">Título del Juego</h2>
            <div id="game-content" class="min-h-[300px]">
                <!-- El contenido de cada juego se inyectará aquí -->
            </div>
            <div id="game-message" class="mt-4 text-lg font-semibold text-center"></div>
        </div>

        <!-- --- Pantalla Final --- -->
        <div id="end-screen" class="hidden text-center bg-white p-8 md:p-12 rounded-2xl shadow-xl">
            <h1 class="text-4xl md:text-5xl font-extrabold text-green-600 mb-4">¡Felicitaciones!</h1>
            <p class="text-2xl text-gray-700 mb-8">¡Has completado todos los desafíos de catequesis!</p>
            <button id="restart-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-12 rounded-lg text-xl transition duration-300">
                Jugar de nuevo
            </button>
        </div>

    </div>

    <script>
        // --- 1. Elementos del DOM ---
        const startScreen = document.getElementById('start-screen');
        const hubScreen = document.getElementById('hub-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        const startBtn = document.getElementById('start-btn');
        const backToHubBtn = document.getElementById('back-to-hub');
        const restartBtn = document.getElementById('restart-btn');

        const gameTitle = document.getElementById('game-title');
        const gameContent = document.getElementById('game-content');
        const gameMessage = document.getElementById('game-message');

        const gameCards = document.querySelectorAll('.game-card');

        // --- 2. Estado del Juego ---
        let completedGames = {
            "armar": false,
            "completar": false,
            "unir-sacr": false,
            "unir-misa": false
        };

        // --- 3. Navegación Principal ---
        startBtn.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            hubScreen.classList.remove('hidden');
        });

        backToHubBtn.addEventListener('click', () => {
            gameScreen.classList.add('hidden');
            hubScreen.classList.remove('hidden');
            gameContent.innerHTML = ''; // Limpiar el juego
            gameMessage.innerHTML = '';
        });

        restartBtn.addEventListener('click', () => {
            endScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            // Resetear estado
            completedGames = { "armar": false, "completar": false, "unir-sacr": false, "unir-misa": false };
            document.querySelectorAll('.game-card').forEach(card => {
                card.classList.remove('completed');
                card.querySelector('.check-mark').style.display = 'none';
            });
        });

        gameCards.forEach(card => {
            card.addEventListener('click', () => {
                const gameId = card.getAttribute('data-game-id');
                if (completedGames[gameId]) return; // No volver a jugar si ya está completo
                
                hubScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                loadGame(gameId);
            });
        });

        // --- 4. Función para marcar juego como completo ---
        function markGameAsComplete(gameId) {
            completedGames[gameId] = true;
            const card = document.getElementById(`card-${gameId}`);
            card.classList.add('completed');
            card.querySelector('.check-mark').style.display = 'block';

            // Verificar si todos están completos
            const allComplete = Object.values(completedGames).every(status => status === true);
            if (allComplete) {
                setTimeout(() => {
                    gameScreen.classList.add('hidden');
                    endScreen.classList.remove('hidden');
                }, 1500); // Esperar un poco antes de mostrar la pantalla final
            } else {
                gameMessage.innerHTML = '<span class="text-green-600">¡Desafío completado! Vuelve al menú para elegir otro.</span>';
            }
        }

        // --- 5. Lógica para cargar cada juego ---
        function loadGame(gameId) {
            gameMessage.innerHTML = '';
            switch (gameId) {
                case 'armar':
                    loadGameArmar();
                    break;
                case 'completar':
                    loadGameCompletar();
                    break;
                case 'unir-sacr':
                    loadGameUnirSacr();
                    break;
                case 'unir-misa':
                    loadGameUnirMisa();
                    break;
            }
        }

        // --- 6. Lógica de Juego: ARMAR (Ordenar) ---
        let armarCurrentStep = 1;

        function loadGameArmar() {
            gameTitle.textContent = 'Armar la Confesión';
            gameContent.innerHTML = `
                <p class="text-lg text-gray-600 mb-6">Haz clic en los 5 pasos para una buena confesión, en el orden correcto.</p>
                <div id="sort-container" class="space-y-3">
                    <!-- Desordenados a propósito -->
                    <div class="sort-item p-4 border rounded-lg text-lg" data-order="3">Propósito de enmienda</div>
                    <div class="sort-item p-4 border rounded-lg text-lg" data-order="1">Examen de conciencia</div>
                    <div class="sort-item p-4 border rounded-lg text-lg" data-order="5">Cumplir la penitencia</div>
                    <div class="sort-item p-4 border rounded-lg text-lg" data-order="2">Dolor de los pecados (Contrición)</div>
                    <div class="sort-item p-4 border rounded-lg text-lg" data-order="4">Decir los pecados al sacerdote (Confesión)</div>
                </div>
            `;
            armarCurrentStep = 1;
            const items = gameContent.querySelectorAll('.sort-item');
            items.forEach(item => {
                item.addEventListener('click', handleArmarClick);
            });
        }

        function handleArmarClick(e) {
            const selectedItem = e.currentTarget;
            const selectedOrder = parseInt(selectedItem.dataset.order);

            if (selectedOrder === armarCurrentStep) {
                selectedItem.classList.add('correct');
                selectedItem.innerHTML += ` <span class="font-bold">(${armarCurrentStep})</span>`;
                selectedItem.removeEventListener('click', handleArmarClick); // Deshabilitar
                armarCurrentStep++;

                if (armarCurrentStep > 5) {
                    markGameAsComplete('armar');
                }
            } else {
                gameMessage.innerHTML = '<span class="text-red-600">¡Orden incorrecto! Intenta de nuevo desde el principio.</span>';
                selectedItem.classList.add('shake');
                setTimeout(() => selectedItem.classList.remove('shake'), 500);
                // Resetear
                armarCurrentStep = 1;
                gameContent.querySelectorAll('.sort-item').forEach(item => {
                    item.classList.remove('correct');
                    item.innerHTML = item.innerHTML.split(' <span')[0]; // Quitar el número
                    item.addEventListener('click', handleArmarClick); // Rehabilitar
                });
            }
        }

        // --- 7. Lógica de Juego: COMPLETAR (Rellenar) ---
        let completarStep = 0;
        const completarData = [
            {
                text: 'Padre Nuestro, que estás en el cielo, santificado sea tu...',
                answer: 'nombre'
            },
            {
                text: '...Venga a nosotros tu...',
                answer: 'reino'
            },
            {
                text: 'Dios te salve, María, llena eres de...',
                answer: 'gracia'
            },
            {
                text: '...el Señor es contigo. Bendita tú eres entre todas las...',
                answer: 'mujeres'
            }
        ];

        function loadGameCompletar() {
            gameTitle.textContent = 'Completar las Oraciones';
            completarStep = 0;
            renderCompletarStep();
        }

        function renderCompletarStep() {
            if (completarStep >= completarData.length) {
                markGameAsComplete('completar');
                return;
            }
            const data = completarData[completarStep];
            gameContent.innerHTML = `
                <p class="text-xl text-gray-700 mb-4">${data.text}</p>
                <input type="text" id="complete-input" class="complete-input w-full p-3 border-2 rounded-lg text-lg" placeholder="Escribe la palabra aquí...">
                <button id="complete-check-btn" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg">Revisar</button>
            `;
            
            const input = document.getElementById('complete-input');
            const button = document.getElementById('complete-check-btn');

            button.addEventListener('click', () => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = data.answer.toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    input.classList.add('correct');
                    input.disabled = true;
                    button.disabled = true;
                    gameMessage.innerHTML = '<span class="text-green-600">¡Correcto!</span>';
                    completarStep++;
                    setTimeout(renderCompletarStep, 1000); // Siguiente
                } else {
                    input.classList.add('incorrect');
                    input.classList.add('shake');
                    setTimeout(() => input.classList.remove('shake'), 500);
                    gameMessage.innerHTML = '<span class="text-red-600">Incorrecto. ¡Inténtalo de nuevo!</span>';
                    setTimeout(() => input.classList.remove('incorrect'), 1000);
                }
            });
        }

        // --- 8. Lógica de Juego: UNIR (Emparejar) ---
        let selectedMatchItem = null;
        let matchedPairs = 0;

        // --- 8a. Datos y Carga de "Unir Sacramentos" ---
        function loadGameUnirSacr() {
            gameTitle.textContent = 'Unir los Sacramentos';
            matchedPairs = 0;
            selectedMatchItem = null;
            
            // Datos (desordenados)
            const colA = [
                { id: 'a1', pair: 'b1', text: 'Bautismo' },
                { id: 'a2', pair: 'b2', text: 'Eucaristía' },
                { id: 'a3', pair: 'b3', text: 'Confirmación' },
                { id: 'a4', pair: 'b4', text: 'Reconciliación' }
            ];
            const colB = [
                { id: 'b1', pair: 'a1', text: 'Nos borra el pecado original y nos hace hijos de Dios.' },
                { id: 'b2', pair: 'a2', text: 'Recibimos el Cuerpo y la Sangre de Cristo.' },
                { id: 'b3', pair: 'a3', text: 'Nos da la fuerza del Espíritu Santo.' },
                { id: 'b4', pair: 'a4', text: 'Dios nos perdona los pecados.' }
            ];
            
            // Inyectar HTML
            gameContent.innerHTML = `
                <p class="text-lg text-gray-600 mb-6">Haz clic en un elemento de la izquierda y luego en su pareja de la derecha.</p>
                <div class="flex flex-col md:flex-row justify-between">
                    <div id="match-col-A" class="space-y-3 w-full md:w-[48%]">${colA.map(item => `<div class="match-item p-4 rounded-lg" data-id="${item.id}" data-pair="${item.pair}">${item.text}</div>`).join('')}</div>
                    <div id="match-col-B" class="space-y-3 w-full md:w-[48%] mt-4 md:mt-0">${colB.map(item => `<div class="match-item p-4 rounded-lg" data-id="${item.id}" data-pair="${item.pair}">${item.text}</div>`).join('')}</div>
                </div>
            `;
            
            // Añadir listeners
            const items = gameContent.querySelectorAll('.match-item');
            items.forEach(item => item.addEventListener('click', (e) => handleUnirClick(e, items, colA.length, 'unir-sacr')));
        }
        
        // --- 8b. Datos y Carga de "Unir Misa y Clero" ---
        function loadGameUnirMisa() {
            gameTitle.textContent = 'El Tesoro de la Misa';
            matchedPairs = 0;
            selectedMatchItem = null;
            
            const colA = [
                { id: 'a1', pair: 'b1', text: 'Cáliz' },
                { id: 'a2', pair: 'b2', text: 'Sagrario' },
                { id: 'a3', pair: 'b3', text: 'Arzobispo de Bogotá (Primado de Colombia)' },
                { id: 'a4', pair: 'b4', text: 'Párroco de San Judas Tadeo (Ibagué)' },
                { id: 'a5', pair: 'b5', text: 'Ambón' }
            ];
            const colB = [
                { id: 'b1', pair: 'a1', text: 'La copa donde se consagra el vino.' },
                { id: 'b2', pair: 'a2', text: 'Lugar donde se guarda la Eucaristía.' },
                { id: 'b3', pair: 'a3', text: 'Cardenal Luis José Rueda Aparicio' },
                { id: 'b4', pair: 'a4', text: 'Mons. Ismael Cardona Aguirre' },
                { id: 'b5', pair: 'a5', text: 'Lugar desde donde se lee la Palabra de Dios.' }
            ];
            
            // Inyectar HTML
            gameContent.innerHTML = `
                <p class="text-lg text-gray-600 mb-6">Haz clic en un elemento de la izquierda y luego en su pareja de la derecha.</p>
                <div class="flex flex-col md:flex-row justify-between">
                    <div id="match-col-A" class="space-y-3 w-full md:w-[48%]">${colA.map(item => `<div class="match-item p-4 rounded-lg" data-id="${item.id}" data-pair="${item.pair}">${item.text}</div>`).join('')}</div>
                    <div id="match-col-B" class="space-y-3 w-full md:w-[48%] mt-4 md:mt-0">${colB.map(item => `<div class="match-item p-4 rounded-lg" data-id="${item.id}" data-pair="${item.pair}">${item.text}</div>`).join('')}</div>
                </div>
            `;
            
            // Añadir listeners
            const items = gameContent.querySelectorAll('.match-item');
            items.forEach(item => item.addEventListener('click', (e) => handleUnirClick(e, items, colA.length, 'unir-misa')));
        }

        // --- 8c. Lógica General de "Unir" ---
        function handleUnirClick(e, allItems, totalPairs, gameId) {
            const clickedItem = e.currentTarget;
            if (clickedItem.classList.contains('matched')) return;

            if (!selectedMatchItem) {
                // Primer clic
                clickedItem.classList.add('selected');
                selectedMatchItem = clickedItem;
            } else {
                // Segundo clic
                if (clickedItem === selectedMatchItem) {
                    // Clic en el mismo item: deseleccionar
                    clickedItem.classList.remove('selected');
                    selectedMatchItem = null;
                    return;
                }

                // Verificar si son pareja
                const pairId = selectedMatchItem.dataset.pair;
                const clickedId = clickedItem.dataset.id;

                if (pairId === clickedId) {
                    // ¡Es una pareja!
                    selectedMatchItem.classList.add('matched');
                    clickedItem.classList.add('matched');
                    selectedMatchItem.classList.remove('selected');
                    matchedPairs++;
                    selectedMatchItem = null;
                    gameMessage.innerHTML = '<span class="text-green-600">¡Correcto!</span>';

                    if (matchedPairs === totalPairs) {
                        markGameAsComplete(gameId);
                    }
                } else {
                    // No son pareja
                    gameMessage.innerHTML = '<span class="text-red-600">No es la pareja correcta.</span>';
                    selectedMatchItem.classList.add('shake');
                    clickedItem.classList.add('shake');
                    
                    selectedMatchItem.classList.remove('selected');
                    selectedMatchItem = null;
                    
                    setTimeout(() => {
                        allItems.forEach(item => item.classList.remove('shake'));
                        gameMessage.innerHTML = '';
                    }, 600);
                }
            }
        }
    </script>
</body>
</html>
